version: "3"

services:
    wzops-django:
        build:
            context: .
            dockerfile: ./docker/django/Dockerfile
        container_name: wzops-django
        depends_on:
            - wzops-mysql
        environment:
            TZ: Asia/Shanghai
        ports:
            - 8000:8000
        expose:
            - 8000
        restart: always
        networks:
            network:
                ipv4_address: 177.8.0.12

    wzops-web:
        container_name: wzops-web
        build:
            context: ./
            dockerfile: ./docker/web/Dockerfile
        depends_on:
            - wzops-django
        ports:
            - 8080:8080
        expose:
            - 8080
        volumes:
            - ./docker/web/nginx.conf:/etc/nginx/conf.d/wzops.conf
        environment:
            TZ: Asia/Shanghai
        networks:
            network:
                ipv4_address: 177.8.0.11

    wzops-mysql:
        image: mysql:8
        container_name: wzops-mysql
        restart: always
        ports:
            - 33060:3306
        expose:
            - 3306
        environment:
            MYSQL_ROOT_PASSWORD: "root"
            MYSQL_DATABASE: "wzops"
            TZ: Asia/Shanghai
        volumes:
            - mysql:/var/lib/mysql
        networks:
            network:
                ipv4_address: 177.8.0.13

    wzops-redis:
        image: redis:7-alpine
        container_name: wzops-redis
        restart: on-failure
        environment:
            - TZ=Asia/Shanghai
        ports:
            - 63790:6379
        expose:
            - 6379
        volumes:
            - redis:/data
        networks:
            network:
                ipv4_address: 177.8.0.15

    wzops-celery:
        build:
            context: .
            dockerfile: ./docker/celery/Dockerfile
        container_name: wzops-celery
        depends_on:
            - wzops-mysql
        environment:
            TZ: Asia/Shanghai
        restart: always
        networks:
            network:
                ipv4_address: 177.8.0.14

volumes:
    mysql:
    redis:

networks:
    network:
        ipam:
            driver: default
            config:
                - subnet: '177.8.0.0/16'
